SD_1=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_2=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_3=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_4=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_5=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_6=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_7=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_8=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_9=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_10=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_11=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_12=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_13=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_14=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_15=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_16=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_17=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_18=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_19=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
SD_20=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
Lenght=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0];
l1=75.326;l2=72;Zmax=l1+l2;
a_max=55;b_max=115;c_max=90;%关节最大角度 


%移动重心
%准备动作用时0.5s
%*********ready*********%
time=0.5;%准备用时时间
T=2;%踏步周期2s
t=linspace(0,T,40);
w=2*pi/T;%角速度
Y=40*sin(2*pi/T*t);% 中心点位移 25mm
plot(t,Y);
%  OK
%Lenght 长度不发生变化
syms x y u
Lenght=146;
eqns=[l1*sin(x)-l2*sin(y)==0,l1*cos(x)+l2*cos(y)==Lenght];
vars=[x,y];
[solx,soly]=solve(eqns,vars);
SD_2(1,1)=abs(vpa(solx(1,1)*180/pi,2));
SD_2(1,1)=roundn(SD_2(1,1),-1);
SD_4(1,1)=abs(vpa(soly(1,1)*180/pi,2));
SD_4(1,1)=roundn(SD_4(1,1),-1)+5;
SD_9(1,1)=SD_4(1,1);
SD_3(1,1)=SD_2(1,1)+SD_4(1,1);
SD_8(1,1)=SD_2(1,1)+SD_4(1,1);
SD_2(1,1)=SD_2(1,1)+4;%向前倾一下
SD_7(1,1)=SD_2(1,1);

for  i=2:10
    SD_2(1,i)=SD_2(1,1);
    SD_3(1,i)=SD_3(1,1);
    SD_4(1,i)=SD_4(1,1);
    SD_7(1,i)=SD_7(1,1);
    SD_8(1,i)=SD_8(1,1);
    SD_9(1,i)=SD_9(1,1);
end

for i=1:10    %0.5s
eqns=[Lenght*sin(u)==Y(1,i)];
vars=[u];
[solu]=solve(eqns,vars);
SD_1(1,i)=abs(vpa(solu(1,1)*180/pi,2));
SD_1(1,i)=roundn(SD_1(1,i),-1);
SD_5(1,i)=SD_1(1,i);
SD_6(1,i)=SD_1(1,i);
SD_10(1,i)=SD_1(1,i);
end
%*****重心移动完毕******%
%**************************************************************************
time=0.5;%抬脚阶段1所用时间
[c0,c1,c2,c3]=orbit_function(time,0,25);%抬脚高度20mm
t=linspace(0,time,10);%时间分配0.5完成  
Lenght_1=Lenght-(c0+c1*t+c2*t.^2+c3*t.^3);
for i=1:10
 %求解二元一次方程组
 %deepth是固定不变  踏步的时候机器人运动轨迹在对其y轴
 %而对Z轴高度其实要求严格，但是要保证LENGYH固定
eqns=[l1*sin(x)-l2*sin(y)==0,l1*cos(x)+l2*cos(y)==Lenght_1(1,i)];
vars=[x y];
[solx,soly]=solve(eqns,vars);
SD_2(1,10+i)=abs(vpa(solx(2,1)*180/pi,2));
SD_4(1,10+i)=abs(vpa(soly(2,1)*180/pi,2));
SD_2(1,10+i)=roundn(SD_2(1,10+i),-1);
SD_4(1,10+i)=roundn(SD_4(1,10+i),-1)+4;  %前面+4了，这次为了对应前面，多以这里也+4
SD_3(1,10+i)=SD_2(1,10+i)+SD_4(1,10+i);
 %234随时间角度不断变化
 %其余角度保持不变
SD_1(1,10+i)=SD_1(1,10);
SD_5(1,10+i)=SD_5(1,10);
SD_6(1,10+i)=SD_6(1,10);
SD_7(1,10+i)=SD_7(1,10);
SD_8(1,10+i)=SD_8(1,10);
SD_9(1,10+i)=SD_9(1,10);
SD_10(1,10+i)=SD_10(1,10)-4;
end
%*******SSP_1 OVER************%
%******* SSP_2 GO ************%
%将腿伸直 并且servo4的角度要稍微的减少一下，
%其实动的角度2.3 把角度倒过来
for i=1:10
 
    %*********************%
    
    SD_1(1,20+i)= SD_1(1,20);
    SD_4(1,20+i)= SD_4(1,20);
    SD_2(1,20+i)= SD_3(1,21-i)-SD_4(1,20);
    if i==10
      SD_4(1,20+i)=30;  
      SD_2(1,20+i)= SD_3(1,21-i)-SD_4(1,20+i);
    end
    
    SD_3(1,20+i)= SD_3(1,21-i);
    
    SD_5(1,20+i)= SD_5(1,20);
    SD_6(1,20+i)= SD_6(1,20);
    SD_7(1,20+i)= SD_7(1,20);
    SD_8(1,20+i)= SD_8(1,20);
    SD_9(1,20+i)= SD_9(1,20);
    SD_10(1,20+i)= SD_10(1,20);
    if i==10
     SD_10(1,20+i)=15.8;%因要承受重力而-5度=10.8  当不承受是要恢复原来角度  15.8
     SD_2(1,20+i)=SD_2(1,20+i)+5;
    end
    
end
%*****************DSP阶段―1********************%
%将屁股移过来，重心点在中间
%重心边右移，边前移
%i从10―30
%Y(1,i)
m=linspace(SD_4(1,30),SD_4(1,2),10);
for i=1:10    
    SD_1(1,30+i)=SD_1(1,11-i);
    SD_3(1,30+i)=SD_3(1,10);%在重心移动过程中角度不变
    SD_5(1,30+i)=SD_5(1,11-i);
    SD_6(1,30+i)=SD_6(1,11-i);
    SD_8(1,30+i)=SD_8(1,10);%在重心移动过程中角度不变
    SD_10(1,30+i)=SD_10(1,11-i);
    %随之servo4（30度）回归原点  servo9变为-servo4之前角度
    SD_4(1,30+i)=m(1,i);
    SD_9(1,30+i)= SD_4(1,2)*2-m(1,11-i);
    SD_2(1,30+i)=SD_3(1,30+i)-SD_4(1,30+i)+5;
    if i==10
       SD_2(1,30+i)= SD_2(1,30+i)-2;  
    end
    SD_7(1,30+i)=SD_8(1,30+i)-SD_9(1,30+i);
end
%******************DSP_2阶段*************************%
%将屁股已到最右边
%其角度按照屁股往右移的时候的角度的负数  41-50
for i=1:10
   SD_1(1,40+i)=-SD_1(1,i);
   SD_2(1,40+i)=SD_2(1,1);
   SD_3(1,40+i)=SD_3(1,1);
   SD_4(1,40+i)=SD_4(1,1);
   SD_5(1,40+i)=-SD_5(1,i);
   SD_6(1,40+i)=-SD_6(1,i);
   SD_7(1,40+i)=SD_7(1,40);
   SD_8(1,40+i)=SD_8(1,40);
   SD_9(1,40+i)=SD_9(1,40);
   SD_10(1,40+i)=-SD_10(1,i);
   if i==10
    SD_1(1,40+i)=SD_1(1,40+i)-5;
   end
end
%在上面的一些计算中  我放了一些+5之类的  是对一些角度的调整
%*****************SSP阶段**************%    51-60
%SD_9平均分布
n=linspace(SD_9(1,50),39.7,10);      
for i=1:10
   SD_1(1,50+i)=SD_1(1,50);
   SD_2(1,50+i)=SD_2(1,50);
   SD_3(1,50+i)=SD_3(1,50);
   SD_4(1,50+i)=SD_4(1,50);
   SD_5(1,50+i)=SD_5(1,50)+4;
   
   SD_6(1,50+i)=SD_6(1,50);
   SD_8(1,50+i)=SD_3(1,10+i);
   
   SD_9(1,50+i)=n(1,i);
   
   SD_7(1,50+i)=SD_8(1,50+i)-SD_9(1,50+i);
   SD_10(1,50+i)=SD_10(1,50);
   
end
%******************SSP_2阶段******************%
                                              %61-70
for i=1:10   
    SD_6(1,60+i)= SD_6(1,60);%因为之前重心在这条腿上，舵机被压下来5度
    SD_9(1,60+i)= SD_9(1,60);
    SD_7(1,60+i)= SD_8(1,61-i)-SD_9(1,60);
    if i==10
      SD_9(1,60+i)=30;  
      SD_7(1,60+i)= SD_8(1,61-i)-SD_9(1,60+i)+5;
    end
    
    SD_8(1,60+i)= SD_8(1,61-i);    
    SD_10(1,60+i)= SD_10(1,60);%因为之前重心在这条腿上，舵机被压下来5度
    
    SD_1(1,60+i)= SD_1(1,60);
    SD_2(1,60+i)= SD_2(1,60);%校正一下，要不重心偏过了
    SD_3(1,60+i)= SD_3(1,60);
    SD_4(1,60+i)= SD_4(1,60);
    SD_5(1,60+i)= SD_5(1,60);%校正一下，要不重心偏过了
    if i==10
         SD_1(1,60+i)= SD_1(1,60)+5;%校正一下，要不重心偏过了
         SD_5(1,60+i)= SD_5(1,60)-7;%校正一下，要不重心偏过了
         SD_2(1,60+i)= SD_2(1,60)+3;%校正一下，要不重心偏过了
    end
    
end
%*****************DSP阶段―1********************%    71-80
%将屁股移过来，重心点在中间
%重心边右移，边前移
%i从10―30
%Y(1,i)
n=linspace(SD_9(1,70),SD_9(1,2),10);  %重心前移
q=linspace(SD_10(1,70),0,10); 
for i=1:10    
    SD_1(1,70+i)=-SD_1(1,11-i);
    SD_3(1,70+i)=SD_3(1,10);%在重心移动过程中角度不变
    SD_5(1,70+i)=-SD_5(1,11-i);
%     if i<2
%      SD_5(1,71)=SD_5(1,61);   %腿放下后不补偿sd5
%     end   
    SD_6(1,70+i)=q(1,i); %这个角度过大
    SD_8(1,70+i)=SD_8(1,10);%在重心移动过程中角度不变
    SD_10(1,70+i)=q(1,i);
    
    
    SD_9(1,70+i)= n(1,i);
    SD_4(1,70+i)=SD_4(1,70)*2-n(1,11-i);
    SD_2(1,70+i)=SD_3(1,70+i)-SD_4(1,70+i)+3;
    SD_7(1,70+i)=SD_8(1,70+i)-SD_9(1,70+i);
    if i==10
    SD_2(1,70+i)=SD_2(1,70+i)-3;
    SD_1(1,70+i)=SD_1(1,70+i)+1;
    SD_1(1,70+i)=SD_1(1,70+i)+1;
    end
end
%*****************DSP阶段―2********************%
%将屁股移过来，重心点从中间移到左脚上
%角度就像刚开始一样，只不过右腿在后放，转动死左脚同开始一样
for i=1:10
SD_6(1,80+i)=SD_6(1,i);
SD_7(1,80+i)=SD_7(1,i);
SD_8(1,80+i)=SD_8(1,i);
SD_9(1,80+i)=SD_9(1,i);
SD_10(1,80+i)=SD_10(1,i);

SD_1(1,80+i)=SD_1(1,i);
SD_5(1,80+i)=SD_5(1,i);

SD_2(1,80+i)=SD_2(1,80);
SD_3(1,80+i)=SD_3(1,80);
SD_4(1,80+i)=SD_4(1,80);
end
%*****************SSP_1阶段*******************%
%将右腿从后面迈向前方
p=linspace(SD_4(1,90),39.7,10);
for i=1:10
   SD_1(1,90+i)=SD_1(1,10);
   SD_3(1,90+i)=SD_3(1,10+i);
   SD_4(1,90+i)=p(1,i);
   SD_2(1,90+i)=SD_3(1,90+i)-SD_4(1,90+i);
   SD_5(1,90+i)=SD_5(1,90);
   
   SD_6(1,90+i)=SD_6(1,20);
   SD_7(1,90+i)=SD_7(1,20);
   SD_8(1,90+i)=SD_8(1,20);
   SD_9(1,90+i)=SD_9(1,20);
   SD_10(1,90+i)=SD_10(1,20);
end
% USART.port='COM36';
% USART.PropertyName='BaudRate';
% USART.PropertyValue=128000;
% obj=serial(USART.port,USART.PropertyName,USART.PropertyValue);

